<!DOCTYPE html>
<html>

<head>
  <base target="_top">
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <!-- The CSS package above applies Google styling to buttons and other elements. -->

  <style>
    .branding-below {
      bottom: 56px;
      top: 0;
    }

    .branding-text {
      left: 7px;
      position: relative;
      top: 3px;
    }

    .col-contain {
      overflow: hidden;
    }

    .col-one {
      float: left;
      width: 50%;
    }

    .logo {
      vertical-align: middle;
    }

    .radio-spacer {
      height: 20px;
    }

    .width-100 {
      width: 100%;
    }
  </style>
  <style>
    /* Remove default bullets */
    ul,
    #myUL {
      list-style-type: none;
    }

    /* Remove margins and padding from the parent ul */
    #myUL {
      margin: 0;
      padding: 0;
    }

    /* Style the caret/arrow */
    .caret {
      cursor: pointer;
      user-select: none;
      /* Prevent text selection */
    }

    /* Create the caret/arrow with a unicode, and style it */
    .caret::before {
      content: "\25B6";
      color: black;
      display: inline-block;
      margin-right: 6px;
    }

    /* Rotate the caret/arrow icon when clicked on (using JavaScript) */
    .caret-down::before {
      transform: rotate(90deg);
    }

    /* Hide the nested list */
    .nested {
      display: none;
    }

    /* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
    .active {
      display: block;
    }
  </style>

</head>

<body>
  <div id="msgBlock">
  </div>

  <div class="sidebar branding-below">
    <form>
      <div id="connectBlock">
        <div class="block form-group">
          <label for="connecturl-text"><b>Connection URL</b></label>
          <textarea class="width-100" id="connecturl-text"
            rows="10">http://ec2-3-7-12-73.ap-south-1.compute.amazonaws.com:28080/aps/JAPI</textarea>
        </div>
        <div class="block form-group">
          <label><b>Olap Server Name</b></label>
          <input type=text id="olapServerName" name="olapServerName"
            value="ec2-3-7-12-73.ap-south-1.compute.amazonaws.com" />
        </div>
        <div class="block form-group">
          <label><b>User Name</b></label>
          <input type=text id="userName" name="userName" value="admin" />
        </div>
        <div class="block form-group">
          <label><b>Password</b></label>
          <input type=password id="password" name="password" value="admin123" />
        </div>
        <div class="block" id="button-bar">
          <button class="blue" id="connect-button">Connect</button>
          <button id="cancel-button" onclick="callClose()">Cancel</button>
        </div>
      </div>
      <div id="pluginUI" hidden>
        <label for="connecturl-text"><b>Connected Succesfully!</b></label></br></p>
        <div class="block" id="button-bar">
          <button class="blue" id="load-button">Load</button>
          <button class="blue" id="logout-button">Logout</button>
          <button id="cancel-button" onclick="callClose()">Cancel</button>
        </div>

      </div>
      <div id="applicationTreeView" hidden>
      </p>
        <ul id="myUL">
          <li><span class="caret">Beverages</span>
            <ul class="nested">
              <li>Water</li>
              <li>Coffee</li>
              <li><span class="caret">Tea</span>
                <ul class="nested">
                  <li>Black Tea</li>
                  <li>White Tea</li>
                  <li><span class="caret">Green Tea</span>
                    <ul class="nested">
                      <li>Sencha</li>
                      <li>Gyokuro</li>
                      <li>Matcha</li>
                      <li>Pi Lo Chun</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </form>
  </div>



  <div class="sidebar bottom">
    <img alt="Add-on logo" class="logo" src="https://www.gstatic.com/images/branding/product/1x/translate_48dp.png"
      width="27" height="27">
    <span class="gray branding-text">Essbase sample by Indrasol</span>
  </div>

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>
    /**
     * On document load, assign click handlers to each button and try to load the
     * user's origin and destination language preferences if previously set.
     */
    var toggler = document.getElementsByClassName("caret");
    var i;

    for (i = 0; i < toggler.length; i++) {
      toggler[i].addEventListener("click", function () {
        this.parentElement.querySelector(".nested").classList.toggle("active");
        this.classList.toggle("caret-down");
      });
    }

    $(function () {
      //alert('setting click');
      //$('#pluginUI').hide();
      $('#connect-button').click(onConnect);
      $('#load-button').click(callLoad);
      $('#logout-button').click(callLogout)
      // $('#insert-text').click(insertText);
      //  google.script.run.withSuccessHandler(loadPreferences)
      //     .withFailureHandler(showError).getPreferences();
      //alert('setting click2');

    });

    function formApplicationTree(returnSuccess,element) {
      console.log(returnSuccess);
      
      var htmlStr = ""

    }
    function callLoad() {
      console.log('inside callLoad.');
      google.script.run
        .withSuccessHandler(
          function (returnSuccess, element) {
            console.log('withsuccess' + returnSuccess);
            //$('#connectBlock').hide();
            //displayUIAfterConnect();
            //element.disabled = false;
            formApplicationTree(returnSuccess,element);
            $('#applicationTreeView').show();
          })
        .withFailureHandler(
          function (msg, element) {
            alert('withfailure');
            showError(msg, $('#button-bar'));
            //element.disabled = false;
          })
        //.withUserObject(this)
        .makeLoadCall();

    }
    function callLogout() {
      console.log('inside callLogout.');
      google.script.run
        .withSuccessHandler(
          function (returnSuccess, element) {
            console.log('withsuccess' + returnSuccess);
            $('#pluginUI').hide();
            $('#connectBlock').show();
            //displayUIAfterConnect();
            //element.disabled = false;
          })
        .withFailureHandler(
          function (msg, element) {
            alert('withfailure');
            showError(msg, $('#button-bar'));
            //element.disabled = false;
          })
        //.withUserObject(this)
        .makeLogoutCall();
    }

    function callClose() {
      callLogout();
      google.script.host.close();
    }

    function onConnect() {
      //alert('hi');
      var url = $('#connecturl-text').val();
      var olapServerNameStr = $('#olapServerName').val();
      var userNameStr = $('#userName').val();
      var passwordStr = $('#password').val();
      alert(url);

      google.script.run
        .withSuccessHandler(
          function (returnSuccess, element) {
            console.log('withsuccess' + returnSuccess);
            $('#connectBlock').hide();
            displayUIAfterConnect();
            //element.disabled = false;
          })
        .withFailureHandler(
          function (msg, element) {
            alert('withfailure');
            showError(msg, $('#button-bar'));
            //element.disabled = false;
          })
        //.withUserObject(this)
        .makeConnectCall(url, olapServerNameStr, userNameStr, passwordStr);
      //google.script.run.makeConnectCall(url,olapServerNameStr,userNameStr,passwordStr);
      //google.script.run.sayHello();
    }
    /**
     * Inserts a div that contains an error message after a given element.
     *
     * @param {string} msg The error message to display.
     * @param {DOMElement} element The element after which to display the error.
     */
    function showError(msg, element) {
      var div = $('<div id="error" class="error">' + msg + '</div>');
      $(element).after(div);
    }

    function displayUIAfterConnect() {
      $('#pluginUI').show();
    }
  </script>

</body>

</html>